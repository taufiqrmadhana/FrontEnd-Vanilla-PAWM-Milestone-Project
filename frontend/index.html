<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ITB SMART-LAB: Study, Master, Apply, Reflect, Thrive</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="icon" href="../assets/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <style>
        body, html {
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
            font-family: 'Montserrat', sans-serif;
            background-color: #f7f9fc;
            scroll-behavior: smooth;
        }
        .container-main {
            flex: 1;
            padding-top: 70px;
        }
        #myCarousel .carousel-item {
            height: 80vh;
            background-color: #777;
            position: relative;
            transition: transform 0.5s ease-in-out;
        }
        #myCarousel .carousel-item img {
            object-fit: cover;
            height: 100%;
            width: 100%;
            opacity: 0.7;
        }
        #myCarousel .carousel-caption {
            position: absolute;
            bottom: 20%;
            left: 10%;
            right: 10%;
            z-index: 2;
            color: #f8f9fa;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.8);
        }
        .navbar {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 0.75rem 1rem;
        }
        .navbar-brand {
            font-weight: 600;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .navbar-nav .nav-link {
            font-weight: 500;
            color: #f8f9fa !important;
        }
        .navbar-nav .nav-link:hover {
            color: #adb5bd !important;
        }
        .profile-button {
            font-weight: 600;
            background-color: #007bff;
            color: #fff !important;
            border-radius: 25px;
            padding: 5px 15px;
        }
        .profile-button img {
            border-radius: 50%;
            width: 25px;
            height: 25px;
            margin-right: 8px;
            vertical-align: middle;
        }
        footer {
            background-color: black;
            padding: 20px;
            text-align: center;
            font-size: 0.9rem;
            color: #6c757d;
            width: 100%;
        }
        .card-title {
            font-weight: bold;
            font-size: 1.1rem;
        }
        .progress-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 150px;
            height: 150px;
            margin: auto;
        }
    
        /* Rotating Border representing the completion percentage */
        .rotating-border {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 8px solid transparent;
            border-top: 8px solid #4caf50;
            border-radius: 50%;
            transform: rotate(0deg); /* Default rotation */
        }
    
        /* Keyframe for rotation animation */
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    
        /* Main Circular Progress */
        .circular-progress {
            width: 120px;
            height: 120px;
            position: relative;
            background: conic-gradient(#4caf50 0% 0%, #e0e0e0 0% 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-size: 1.5rem;
            font-weight: bold;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
    
        .circular-progress span {
            position: relative;
            font-size: 1.6rem;
            font-weight: 600;
            color: black;
        }
        
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="/">
                <img src="./assets/logo_itb_1024.png" alt="ITB Logo" width="30" height="30" class="d-inline-block align-top">
                SMART-LAB
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/interactive">Interactive Lab</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/materials">Materials</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/quiz">Quiz</a>
                    </li>
                    <li class="nav-item dropdown ms-3">
                        <a class="nav-link dropdown-toggle profile-button" href="#" id="profileMenuButton" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="https://mdbcdn.b-cdn.net/img/new/avatars/2.webp" alt="Profile Image"> 
                            <span id="usernameDisplay">Paul Pogba</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileMenuButton">
                            <li><a class="dropdown-item" href="/auth/logout">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>    

    <div class="container-fluid container-main">
        <div class="row">
            <div class="col-lg-8 p-0">
                <div id="myCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="0" class="active" aria-current="true"></button>
                        <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="1"></button>
                        <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="2"></button>
                    </div>
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="./assets/1.jpg" class="d-block w-100" alt="First slide">
                            <div class="carousel-caption text-start">
                                <h1>Explore Interactive Labs.</h1>
                                <p>Engage with hands-on labs in mathematics and programming. Visualize functions, run simulations, and learn by doing.</p>
                                <p><a class="btn btn-lg btn-primary" href="/interactive" role="button">Try a Lab</a></p>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img src="./assets/2.jpg" class="d-block w-100" alt="Second slide">
                            <div class="carousel-caption">
                                <h1>Comprehensive Learning Materials.</h1>
                                <p>Access high-quality resources across various topics in mathematics and programming to strengthen your foundations and build advanced skills.</p>
                                <p><a class="btn btn-lg btn-primary" href="/materials" role="button">Browse Materials</a></p>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img src="./assets/3.jpg" class="d-block w-100" alt="Third slide">
                            <div class="carousel-caption text-end">
                                <h1>Track and Improve Your Skills.</h1>
                                <p>Monitor your progress with quizzes, track your strengths, and identify areas for improvement. Make learning measurable and fun!</p>
                                <p><a class="btn btn-lg btn-primary" href="/quiz" role="button">Start a Quiz</a></p>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#myCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#myCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="row g-3">
                    <div class="col-12">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Current Time</h5>
                                <p id="clock" class="display-4"></p>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Daily Learning Tips</h5>
                            <div id="tipCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000">
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <p>"Learning is a journey, not a race. Take it one step at a time."</p>
                                    </div>
                                    <div class="carousel-item">
                                        <p>"Focus on understanding concepts, not just memorizing."</p>
                                    </div>
                                    <div class="carousel-item">
                                        <p>"Ask questions! Curiosity is the key to deeper understanding."</p>
                                    </div>
                                    <div class="carousel-item">
                                        <p>"Practice makes perfect. Review regularly."</p>
                                    </div>
                                    <div class="carousel-item">
                                        <p>"Remember to take breaks and give your brain time to rest."</p>
                                    </div>
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#tipCarousel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#tipCarousel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Materials Completed</h5>
                                <div class="progress-container">
                                    <div class="circular-progress" id="materialsProgress"><span>0%</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Latest Quiz Score</h5>
                                <div class="progress-container">
                                    <div class="circular-progress" id="quizScoreProgress">
                                        <span>0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>                    
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Daily Routine Checklist</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span><input type="checkbox" class="form-check-input me-2" id="checkMaterials"> Review Today's Materials</span>
                                        <i class="fas fa-check-circle text-muted" id="iconMaterials" style="opacity: 0.3;"></i>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span><input type="checkbox" class="form-check-input me-2" id="checkQuiz"> Complete a Practice Quiz</span>
                                        <i class="fas fa-check-circle text-muted" id="iconQuiz" style="opacity: 0.3;"></i>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span><input type="checkbox" class="form-check-input me-2" id="checkTip"> Read a Learning Tip</span>
                                        <i class="fas fa-check-circle text-muted" id="iconTip" style="opacity: 0.3;"></i>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span><input type="checkbox" class="form-check-input me-2" id="checkProgress"> Update Progress Tracker</span>
                                        <i class="fas fa-check-circle text-muted" id="iconProgress" style="opacity: 0.3;"></i>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 ITB SMART-LAB. All Rights Reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Function to fetch and update quiz score progress
        function updateQuizProgress() {
            fetch('/api/get-previous-score')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const quizScore = data.previousScore || 0; // Default to 0 if no score exists
                        // Update the progress bar and text for quiz score
                        const quizScoreProgress = document.getElementById('quizScoreProgress');
                        quizScoreProgress.querySelector('span').textContent = `${quizScore}%`;
                        quizScoreProgress.style.background = `conic-gradient(#4caf50 ${quizScore}%, #e0e0e0 ${quizScore}% 100%)`;
                    }
                })
                .catch(error => console.error('Error fetching previous quiz score:', error));
        }

        // Function to fetch and update materials progress (e.g., video progress)
        async function updateProgress() {
            try {
                // Fetch the materials completion percentage
                const materialsRes = await fetch('/api/average-grade');
                const materialsData = await materialsRes.json();
                const materialsCompletion = materialsData.completionPercentage || 0;
                document.getElementById('materialsProgress').querySelector('span').textContent = `${materialsCompletion}%`;
                document.getElementById('materialsProgress').style.background = `conic-gradient(#4caf50 ${materialsCompletion}%, #e0e0e0 ${materialsCompletion}% 100%)`;

                // Fetch the average quiz score
                updateQuizProgress(); // Ensure quiz progress is updated separately

            } catch (error) {
                console.error('Error fetching progress data:', error);
            }
        }

        // Call the update function when the page is loaded
        updateProgress();


        // Fetch average completion percentage from /api/average-grade
        // Fetch and update Materials Completed
        fetch('/api/average-grade')
            .then(response => response.json())
            .then(data => {
                const completionPercentage = data.completionPercentage || 0;
                const progressTextMaterials = document.getElementById('materialsProgress').querySelector('span');
                const rotatingBorderMaterials = document.getElementById('rotatingBorderMaterials');

                // Update the percentage text and rotation
                progressTextMaterials.textContent = `${completionPercentage}%`;
                rotatingBorderMaterials.style.transform = `rotate(${(completionPercentage / 100) * 360}deg)`;
            })
            .catch(error => console.error('Error fetching materials completion percentage:', error));

        // Fetch and update Average Quiz Score
        fetch('/api/quiz-scores')
            .then(response => response.json())
            .then(data => {
                const quizScore = data.averageScore || 0;
                const progressTextQuiz = document.getElementById('quizScoreProgress').querySelector('span');
                const rotatingBorderQuiz = document.getElementById('rotatingBorderQuiz');

                // Update the percentage text and rotation
                progressTextQuiz.textContent = `${quizScore}%`;
                rotatingBorderQuiz.style.transform = `rotate(${(quizScore / 100) * 360}deg)`;
            })
            .catch(error => console.error('Error fetching quiz score:', error));

        
        function updateClock() {
            const clockElement = document.getElementById('clock');
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            clockElement.textContent = `${hours}:${minutes}:${seconds}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        const tips = [
        "Learning is a journey, not a race. Take it one step at a time.",
        "Focus on understanding concepts, not just memorizing facts.",
        "Ask questions! Curiosity is the key to deeper understanding.",
        "Practice makes perfect. Review what you've learned regularly.",
        "Remember to take breaks and give your brain time to rest."
        ];

        function nextTip() {
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            document.getElementById('dailyTip').textContent = randomTip;
        }
        document.querySelectorAll('.form-check-input').forEach((checkbox, index) => {
            const icon = document.getElementById(`icon${checkbox.id.replace('check', '')}`);
            
            checkbox.addEventListener('change', () => {
                if (checkbox.checked) {
                    icon.classList.replace('text-muted', 'text-success');
                    icon.style.opacity = 1;
                } else {
                    icon.classList.replace('text-success', 'text-muted');
                    icon.style.opacity = 0.3;
                }
            });
        });

    </script>
    <script>
        // Mendapatkan nama pengguna dari sesi melalui endpoint
        fetch('/auth/user')
            .then(response => response.json())
            .then(data => {
                if (data.username) {
                    document.getElementById('usernameDisplay').textContent = data.username;
                }
            })
            .catch(error => {
                console.error("Error fetching user data:", error);
            });
    </script>
</body>
</html>
